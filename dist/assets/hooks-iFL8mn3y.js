const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ui-components-DSfz5Cov.js","assets/react-vendor-Y7T1HomI.js","assets/supabase-L-NHoLOp.js","assets/jspdf.es.min-Cj24ZQjq.js"])))=>i.map(i=>d[i]);
import{_ as V}from"./supabase-L-NHoLOp.js";import{r as s,g as W,a as Y,b as J,e as K,h as Q,i as X,k as ee,m as oe,n as ae,o as $,u as te,s as _}from"./ui-components-DSfz5Cov.js";const re="+593984280334",se="+593998799579",z={PICHINCHA:"0122407273 (Jeremias Joel Guale)",GUAYAQUIL:"0122407273 (Jeremias Joel Guale)",PACIFICO:"1061220256 (Byron Guale)",PAYPAL:"guale2023@outlook.com"};function he(p){const[y,h]=s.useState(!1),[C,T]=s.useState({isOpen:!1,message:""}),N=t=>{T({isOpen:!0,message:t})},S=()=>{T({isOpen:!1,message:""})},D=t=>{const{service:A,price:g,duration:m,devices:u,customer:f,phone:E,email:P,paymentMethod:w,notes:b}=t;return`🎬✨ *Nueva Compra - StreamZone* ✨🎬

👋 ¡Hola! Tenemos una nueva compra registrada 👋

👤 *Cliente:* ${f}
📱 *WhatsApp:* ${E}
📧 *Email:* ${P||"No proporcionado"}

🎯 *Detalles del Servicio:*
🎬 *Servicio:* ${A}
💰 *Precio:* $${g}
⏱️ *Duración:* ${m} ${m===1?"mes":"meses"}
📱 *Dispositivos:* ${u}
💳 *Método de pago:* ${w}
📝 *Notas:* ${b||"Ninguna"}

💳 *Datos para transferencia:*
🏦 *Pichincha:* ${z.PICHINCHA}
🏛️ *Guayaquil:* ${z.GUAYAQUIL}
🌊 *Pacífico:* ${z.PACIFICO}
💳 *PayPal:* ${z.PAYPAL}

🎉✨ ¡Gracias por tu compra! ✨🎉
💝 ¡Esperamos que disfrutes tu servicio! 💝`},n=t=>{const A=D(t),g=`https://wa.me/${re.replace("+","")}?text=${encodeURIComponent(A)}`,m=`https://wa.me/${se.replace("+","")}?text=${encodeURIComponent(A)}`,u=document.createElement("div");u.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",u.innerHTML=`
      <div class="bg-white rounded-xl p-6 max-w-md mx-4 shadow-2xl">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-gray-800">¡Compra Registrada! 🎉</h3>
          <button id="closeModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        <div class="bg-orange-50 border border-orange-200 rounded-lg p-3 mb-4">
          <p class="text-orange-800 text-sm font-medium">⚠️ PASO OBLIGATORIO</p>
          <p class="text-orange-700 text-xs mt-1">Debes contactar por WhatsApp para confirmar tu compra y recibir las credenciales</p>
        </div>
        <p class="text-gray-600 mb-6">Selecciona un agente para continuar con tu compra:</p>
        <div class="space-y-3">
          <button id="agent1" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-semibold transition-colors">
            👨‍💼 Agente 1 (+593 98 428 0334)
          </button>
          <button id="agent2" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold transition-colors">
            👨‍💼 Agente 2 (+593 99 879 9579)
          </button>
        </div>
      </div>
    `,document.body.appendChild(u);const f=()=>{try{u&&u.parentNode&&document.body.removeChild(u)}catch{console.log("Modal ya cerrado")}};document.getElementById("agent1")?.addEventListener("click",()=>{f(),setTimeout(()=>{try{window.open(g,"_blank")}catch{alert("No se pudo abrir WhatsApp automáticamente. Por favor, contacta al Agente 1: +593 98 428 0334")}},100)}),document.getElementById("agent2")?.addEventListener("click",()=>{f(),setTimeout(()=>{try{window.open(m,"_blank")}catch{alert("No se pudo abrir WhatsApp automáticamente. Por favor, contacta al Agente 2: +593 99 879 9579")}},100)}),document.getElementById("closeModal")?.addEventListener("click",f)};return{processPurchase:async t=>{h(!0);try{console.log("🛒 Procesando compra para usuario registrado:",t);const A={customer:t.customer||"Cliente StreamZone",phone:t.phone||"+593000000000",service:t.service||"Servicio Premium",price:t.price||10,duration:t.duration||1,devices:t.devices||1,total:t.total||10,paymentMethod:t.paymentMethod||"pichincha",notes:t.notes||"",email:t.email||"cliente@streamzone.com",start:t.start||new Date().toISOString().slice(0,10),end:t.end||new Date(Date.now()+720*60*60*1e3).toISOString().slice(0,10)};console.log("✅ Datos garantizados para usuario registrado:",A),console.log("🎯 Mostrando panel de agentes..."),n(A);try{console.log("💾 Intentando guardar en BD en segundo plano..."),console.log("🔍 Buscando usuario existente por email:",t.email);const{data:g}=await W(t.email);let m=g?.id,u=g?.phone;if(m)console.log("✅ Usuario encontrado por email:",m),console.log("📱 Teléfono del usuario en BD:",u);else{console.log("🔍 Usuario no encontrado por email, buscando por teléfono:",t.phone);const{data:f,error:E}=await Y(t.phone);if(f?.id)m=f.id,u=f.phone,console.log("✅ Usuario encontrado por teléfono:",m);else{console.log("👤 Usuario no encontrado, creando nuevo usuario...");const P={name:t.customer,phone:t.phone,email:t.email||"sin-email@temp.com"},{data:w,error:b}=await J(P);if(b){console.warn("⚠️ Error creando usuario:",b),console.error("❌ NO SE PUEDE CONTINUAR SIN USUARIO VÁLIDO");return}else m=w?.id,u=w?.phone,console.log("✅ Usuario creado exitosamente:",m)}}if(m){console.log("🎯 TENEMOS userId:",m);const f={customer:t.customer,phone:u||t.phone,service:t.service,start:t.start,end:t.end,months:t.duration,validated:!1};console.log("📱 Teléfono del formulario:",t.phone),console.log("📱 Teléfono de la BD (usado):",u||t.phone),console.log("💾 Guardando compra pendiente en BD (campos correctos):",f),console.log("🔍 Llamando a createPurchase con:",JSON.stringify(f,null,2));const{data:E,error:P}=await K(f);P?(console.error("❌ Error guardando compra:",P),console.error("❌ Detalles del error:",JSON.stringify(P,null,2)),console.error("❌ Tipo de error:",typeof P),console.error("❌ Mensaje del error:",P.message)):(console.log("✅ Compra guardada como pendiente:",E),console.log("✅ ID de la compra guardada:",E?.id),console.log("✅ Validated status:",E?.validated),console.log("🎯 ¡COMPRA GUARDADA EXITOSAMENTE! Debería aparecer en admin."),console.log("🔄 Forzando recarga inmediata de compras pendientes..."),setTimeout(async()=>{try{const{getPendingPurchases:w}=await V(async()=>{const{getPendingPurchases:O}=await import("./ui-components-DSfz5Cov.js").then(U=>U.F);return{getPendingPurchases:O}},__vite__mapDeps([0,1,2])),b=await w();console.log("🔄 RESULTADO INMEDIATO de getPendingPurchases:",b),console.log("🔄 Compras pendientes encontradas:",b.data?.length||0)}catch(w){console.error("❌ Error en recarga inmediata:",w)}},1e3))}else console.error("❌ NO HAY userId - NO SE PUEDE GUARDAR LA COMPRA"),console.error("❌ purchaseData:",t)}catch(g){console.warn("⚠️ Error en BD (no crítico):",g)}}catch(A){console.error("❌ Error crítico:",A),N("Error al procesar la compra. Por favor, inténtalo de nuevo.")}finally{h(!1)}},isProcessing:y,generateWhatsAppMessage:D,errorModal:C,closeErrorModal:S}}function Ee(p){const[y,h]=s.useState([]),[C,T]=s.useState([]),[N,S]=s.useState([]),[D,n]=s.useState([]),[I,t]=s.useState(null),[A,g]=s.useState(!1),[m,u]=s.useState(null),f=async()=>{g(!0),u(null);try{console.log("🔄 loadAllPurchasesFromSupabase: Iniciando carga...");const e=await ae();return console.log("🔄 loadAllPurchasesFromSupabase: Resultado recibido:",e),e.data&&Array.isArray(e.data)?(h(e.data),console.log("✅ loadAllPurchasesFromSupabase: Todas las compras cargadas desde Supabase:",e.data.length),e.data.length>0&&console.log("📋 Primeras 3 compras:",e.data.slice(0,3).map(r=>({id:r.id,customer:r.customer,validated:r.validated,created_at:r.created_at}))),e.data):(console.warn("⚠️ loadAllPurchasesFromSupabase: No se pudieron cargar las compras desde Supabase"),h([]),[])}catch(e){return console.error("❌ loadAllPurchasesFromSupabase: Error cargando compras desde Supabase:",e),u("Error cargando compras desde la base de datos"),h([]),[]}finally{g(!1)}},E=async()=>{try{console.log("🔄 loadPendingPurchases: Iniciando carga...");const e=await Q();return console.log("🔄 loadPendingPurchases: Resultado recibido:",e),e.data&&Array.isArray(e.data)?(T(e.data),console.log("✅ loadPendingPurchases: Compras pendientes cargadas:",e.data.length),e.data):(console.log("⚠️ loadPendingPurchases: No hay datos o no es array, estableciendo array vacío"),T([]),[])}catch(e){return console.error("❌ loadPendingPurchases: Error cargando compras pendientes:",e),T([]),[]}},P=async e=>{try{const r=await oe(e);return r.data?(S(r.data),console.log("✅ Compras activas del usuario cargadas:",r.data.length),r.data):(S([]),[])}catch(r){return console.error("❌ Error cargando compras del usuario:",r),S([]),[]}},w=async()=>{try{const e=await ee(7);return e.data?(n(e.data),console.log("✅ Servicios próximos a vencer cargados:",e.data.length),e.data):(n([]),[])}catch(e){return console.error("❌ Error cargando servicios próximos a vencer:",e),n([]),[]}},b=async()=>{try{const e=await X();return e.data?(t(e.data),console.log("✅ Estadísticas de renovaciones cargadas"),e.data):(t(null),null)}catch(e){return console.error("❌ Error cargando estadísticas de renovaciones:",e),t(null),null}},O=async()=>{console.log("🔄 refreshAllStats: Iniciando recarga completa..."),g(!0),u(null);try{console.log("🔄 refreshAllStats: Cargando todas las compras..."),await f(),console.log("🔄 refreshAllStats: Cargando compras pendientes..."),await E(),console.log("🔄 refreshAllStats: Cargando servicios próximos a vencer..."),await w(),console.log("🔄 refreshAllStats: Cargando estadísticas de renovaciones..."),await b(),console.log("✅ refreshAllStats: Todas las estadísticas actualizadas desde Supabase")}catch(e){console.error("❌ refreshAllStats: Error actualizando estadísticas:",e),u("Error actualizando estadísticas")}finally{g(!1)}};return s.useEffect(()=>{console.log("🔄 useSupabaseData: Iniciando carga de datos de admin..."),O()},[p]),s.useEffect(()=>{console.log("🔄 useSupabaseData: Cargando compras pendientes al inicio..."),(async()=>{const r=await E();console.log("🎯 RESULTADO INICIAL loadPendingPurchases:",r)})()},[]),s.useEffect(()=>{{console.log("🔄 useSupabaseData: Iniciando actualización automática cada 5 segundos...");const e=setInterval(async()=>{console.log("🔄 ACTUALIZACIÓN AUTOMÁTICA: Recargando compras pendientes...");try{const r=await E();console.log("🔄 ACTUALIZACIÓN AUTOMÁTICA: Compras pendientes:",r?.length||0)}catch(r){console.error("❌ Error en actualización automática:",r)}},5e3);return()=>{console.log("🛑 useSupabaseData: Deteniendo actualización automática..."),clearInterval(e)}}},[p]),s.useEffect(()=>{S([])},[p]),s.useEffect(()=>{const e=r=>{r.key==="userPhone"&&r.newValue&&(console.log("🔄 Teléfono de usuario cambiado, recargando compras..."),g(!0),P(r.newValue).finally(()=>g(!1)))};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]),{allPurchases:y,pendingPurchases:C,userActivePurchases:N,expiringServices:D,renewalStats:I,loading:A,error:m,loadAllPurchasesFromSupabase:f,loadPendingPurchases:E,loadUserActivePurchases:P,loadExpiringServices:w,loadRenewalStats:b,refreshAllStats:O,refreshUserPurchases:async e=>{console.log("🔄 Forzando recarga de compras del usuario:",e),g(!0);try{const r=await P(e);return console.log("✅ Compras del usuario recargadas:",r?.length||0),r}catch(r){return console.error("❌ Error recargando compras del usuario:",r),[]}finally{g(!1)}}}}const ve=()=>{const[p,y]=s.useState(()=>$.load("userProfile",null)),[h,C]=s.useState(()=>!!$.load("adminLogged",!1)),[T,N]=s.useState(()=>$.load("userProfileData",null)),[S,D]=s.useState(()=>$.load("allPurchases",[])),[n,I]=s.useState("login"),[t,A]=s.useState(""),[g,m]=s.useState(""),[u,f]=s.useState("");return s.useEffect(()=>{$.save("userProfile",p)},[p]),s.useEffect(()=>{$.save("userProfileData",T)},[T]),s.useEffect(()=>{$.save("allPurchases",S)},[S]),s.useEffect(()=>{$.save("adminLogged",h)},[h]),{user:p,setUser:y,adminLogged:h,setAdminLogged:C,userProfile:T,setUserProfile:N,allPurchases:S,setAllPurchases:D,authStep:n,setAuthStep:I,resetEmail:t,setResetEmail:A,resetToken:g,setResetToken:m,resetCode:u,setResetCode:f,handleLogin:r=>{y(r)},handleLogout:()=>{y(null),N(null)},handleAdminLogin:r=>{r&&C(!0)},handleAdminLogout:()=>{C(!1)},handleForgotPassword:(r,M)=>{A(r),m(M),I("code")},handleCodeVerified:r=>{m(r),I("newpassword")},handlePasswordReset:()=>{I("login")}}},ne=[{email:"gualejeremi@gmail.com",role:"principal",canGenerateKeys:!1,canDeleteOthers:!0,isProtected:!0}],Se=(p=[],y,h)=>{const[C,T]=s.useState(ne),[N,S]=s.useState(!1),[D,n]=s.useState(""),[I,t]=s.useState("dashboard"),[A,g]=s.useState(!1),[m,u]=s.useState(!1),[f,E]=s.useState(!1),[P,w]=s.useState(!1),[b,O]=s.useState(null),[U,e]=s.useState(!1),[r,M]=s.useState(null),B=C.map(a=>a.email);return{adminUsers:C,setAdminUsers:T,loading:N,setLoading:S,msg:D,setMsg:n,adminView:I,setAdminView:t,adminDrawerOpen:A,setAdminDrawerOpen:g,adminMenuOpen:m,setAdminMenuOpen:u,adminRegisterPurchaseOpen:f,setAdminRegisterPurchaseOpen:E,editPurchaseOpen:P,setEditPurchaseOpen:w,editingPurchase:b,setEditingPurchase:O,approvePurchaseOpen:U,setApprovePurchaseOpen:e,selectedPurchase:r,setSelectedPurchase:M,adminEmails:B,handleToggleValidate:async a=>{console.log("🔍 handleToggleValidate called with ID:",a),console.log("📦 Current purchases:",p);const c=p.find(d=>d.id===a);if(console.log("🎯 Found purchase:",c),!c){console.log("❌ Purchase not found");return}if(!c.validated){M(c),e(!0);return}const o="invalidar";if(console.log("🔄 Invalidating purchase:",a),!_){console.error("❌ Supabase no está configurado"),n("❌ Error: Base de datos no disponible"),setTimeout(()=>n(""),3e3);return}if(!confirm(`¿Estás seguro de que quieres ${o} la compra de ${c.customer} - ${c.service}?`)){console.log("❌ User cancelled");return}S(!0);try{console.log("🔄 Actualizando en Supabase...",{purchaseId:a,validated:!1});const{error:d}=await _.from("purchases").update({validated:!1}).eq("id",a);if(d)throw console.error("❌ Error de Supabase:",d),d;console.log("✅ Actualización en Supabase exitosa"),y(l=>l.map(v=>v.id===a?{...v,validated:!1}:v)),n(`✅✨ Compra invalidada exitosamente ✨✅
🔄 El cliente puede volver a solicitar cuando guste 🔄`),setTimeout(()=>n(""),3e3),h&&(console.log("🔄 Recargando datos desde Supabase..."),await h())}catch(d){console.error("Error al actualizar compra:",d),n("❌ Error al actualizar la compra"),setTimeout(()=>n(""),3e3)}finally{S(!1)}},handleDeletePurchase:async a=>{console.log("🗑️ handleDeletePurchase called with ID:",a),console.log("📦 Current purchases:",p);const c=p.find(d=>d.id===a);if(console.log("🎯 Found purchase:",c),!c){console.log("❌ Purchase not found");return}c.validated;const o=c.validated?`⚠️ ADVERTENCIA: ¿Estás seguro de que quieres ELIMINAR PERMANENTEMENTE la compra activa de ${c.customer} - ${c.service}?

Esta acción:
• Eliminará la compra de la base de datos
• El cliente perderá acceso al servicio
• NO se puede deshacer

Escribe "ELIMINAR" para confirmar:`:`¿Estás seguro de que quieres rechazar la compra de ${c.customer} - ${c.service}?`;if(confirm(o)){if(!_){console.error("❌ Supabase no está configurado"),n("❌ Error: Base de datos no disponible"),setTimeout(()=>n(""),3e3);return}if(c.validated&&prompt("Para confirmar la eliminación, escribe exactamente: ELIMINAR")!=="ELIMINAR"){alert('❌ Eliminación cancelada. Debes escribir "ELIMINAR" para confirmar.');return}S(!0);try{console.log("🗑️ Eliminando de Supabase...",{purchaseId:a});const{error:d}=await _.from("purchases").delete().eq("id",a);if(d)throw console.error("❌ Error de Supabase:",d),d;console.log("✅ Eliminación en Supabase exitosa"),y(l=>l.filter(v=>v.id!==a)),n(`✅✨ Compra ${c.validated?"eliminada":"rechazada"} exitosamente ✨✅
🗑️ La compra ha sido removida del sistema 🗑️`),setTimeout(()=>n(""),3e3),h&&(console.log("🔄 Recargando datos desde Supabase..."),await h())}catch(d){console.error("Error al eliminar compra:",d),n("❌ Error al eliminar la compra"),setTimeout(()=>n(""),3e3)}finally{S(!1)}}},handleEditPurchase:a=>{O(a),w(!0)},handleReminderPurchase:a=>{const c=new Date,o=new Date(a.end),d=Math.ceil((o.getTime()-c.getTime())/(1e3*60*60*24));let l=`🎬✨ *StreamZone* ✨🎬
`;l+=`🌟 *Recordatorio de Renovación* 🌟

`,l+=`👋 ¡Hola *${a.customer}*! 👋

`,l+=`💝 Esperamos que estés disfrutando de nuestros servicios 💝

`,d<=0?(l+=`😔 ¡Ups! Su servicio *${a.service}* venció el ${a.end} 😔

`,l+=`🔄✨ ¡No te preocupes! Podemos reactivarlo fácilmente ✨🔄

`,l+=`💬📱 Solo responde este mensaje y te ayudamos al instante 📱💬

`):d===1?(l+=`⏰🚨 Su servicio *${a.service}* vence *MAÑANA* (${a.end}) 🚨⏰

`,l+=`🔥 ¡Renueva ahora y sigue disfrutando sin interrupciones! 🔥

`,l+=`💬📱 Responde este mensaje para renovar al instante 📱💬

`):d<=3?(l+=`📅⏳ Su servicio *${a.service}* vence en *${d} días* (${a.end}) ⏳📅

`,l+=`🎯 ¡Renueva con anticipación y mantén tu entretenimiento continuo! 🎯

`,l+=`💬📱 Responde este mensaje cuando quieras renovar 📱💬

`):(l+=`📋💌 Recordatorio amigable: Su servicio *${a.service}* vence en *${d} días* (${a.end}) 💌📋

`,l+=`😊 ¡Tienes tiempo! Renueva cuando te sea conveniente 😊

`,l+=`💬📱 Responde este mensaje cuando quieras proceder 📱💬

`),l+=`🎁 *Beneficios de renovar con nosotros:*
`,l+=`✅ Atención personalizada 24/7
`,l+=`✅ Precios competitivos
`,l+=`✅ Activación inmediata
`,l+=`✅ Soporte técnico incluido

`,l+=`🤝 *¡Gracias por confiar en StreamZone!* 🤝
`,l+=`💖 *Equipo StreamZone* 💖
`,l+="🎬✨ *Tu entretenimiento es nuestra pasión* ✨🎬";const R=`https://wa.me/593${a.phone.replace(/[^\d]/g,"")}?text=${encodeURIComponent(l)}`;try{window.open(R,"_blank"),n(`📱✨ Recordatorio enviado exitosamente a ${a.customer} ✨📱
💬 El cliente recibirá un mensaje cálido y atractivo 💬`),setTimeout(()=>n(""),5e3)}catch(F){console.error("Error abriendo WhatsApp:",F),n("❌ Error al abrir WhatsApp. Por favor, contacta manualmente."),setTimeout(()=>n(""),3e3)}},handleApproveSuccess:async()=>{if(console.log("🎉 handleApproveSuccess called"),console.log("🎯 selectedPurchase:",r),console.log("🔄 Actualizando estado local inmediatamente..."),y(a=>{const c=a.map(o=>o.id===r?.id?{...o,validated:!0}:o);return console.log("📋 Estado actualizado:",c),c}),console.log("🔄 Forzando re-render del componente..."),h){console.log("🔄 Recargando datos desde Supabase después de aprobación...");try{await h(),console.log("✅ Datos recargados exitosamente desde Supabase"),r&&r.phone&&console.log("🔄 Forzando recarga de compras del usuario:",r.phone)}catch(a){console.error("❌ Error recargando datos:",a)}}else console.warn("⚠️ refreshFromSupabase function not available")},handleUpdatePurchase:async(a,c)=>{console.log("🔄 ===== INICIANDO ACTUALIZACIÓN DE COMPRA ====="),console.log("🆔 Purchase ID:",a),console.log("📝 Updates recibidos:",c),console.log("📊 Tipo de updates:",typeof c),console.log("🔍 Keys de updates:",Object.keys(c));try{if(!a||a==="undefined"||a==="null")throw new Error("ID de compra inválido");if(!c||Object.keys(c).length===0)throw new Error("No hay datos para actualizar");console.log("💾 Guardando cambios en Supabase..."),console.log("📤 Datos enviados a updatePurchase:",{id:a,updateData:c});const{data:o,error:d}=await te(a,c);if(console.log("📥 Respuesta de updatePurchase:",{data:o,error:d}),d){console.error("❌ Error guardando en Supabase:",d),console.error("❌ Detalles del error:",{code:d.code,message:d.message,details:d.details,hint:d.hint}),n(`❌ Error al guardar: ${d.message}`),setTimeout(()=>n(""),5e3);return}console.log("✅ Cambios guardados exitosamente en Supabase:",o),console.log("🔄 Actualizando estado local..."),y(l=>{const v=l.map(R=>R.id===a?{...R,...c}:R);return console.log("📊 Estado local actualizado:",v.find(R=>R.id===a)),v}),n("✅ Compra actualizada correctamente en la base de datos"),setTimeout(()=>n(""),5e3),h&&(console.log("🔄 Recargando datos desde Supabase..."),await h(),console.log("✅ Datos recargados desde Supabase")),console.log("🎉 ===== ACTUALIZACIÓN COMPLETADA EXITOSAMENTE =====")}catch(o){console.error("❌ ===== ERROR EN ACTUALIZACIÓN ====="),console.error("❌ Error actualizando compra:",o),console.error("❌ Stack trace:",o.stack),n(`❌ Error: ${o.message}`),setTimeout(()=>n(""),5e3)}},handleExportCSV:async()=>{try{const a=(await V(async()=>{const{default:i}=await import("./jspdf.es.min-Cj24ZQjq.js").then(x=>x.j);return{default:i}},__vite__mapDeps([3,2,1]))).default,c=(await V(async()=>{const{default:i}=await import("./jspdf.plugin.autotable-DZlIrCiz.js");return{default:i}},[])).default,o=new a;o.setFontSize(20),o.setFont("helvetica","bold"),o.text("📊 REPORTE DE COMPRAS - StreamZone",20,30),o.setFontSize(12),o.setFont("helvetica","normal"),o.text("Sistema de Gestión de Servicios de Streaming",20,45),o.text(`Fecha de generación: ${new Date().toLocaleDateString("es-ES")}`,20,55),o.text(`Hora de generación: ${new Date().toLocaleTimeString("es-ES")}`,20,65);const l=[["Cliente","Teléfono","Servicio","Inicio","Fin","Estado","Creado"]];p.forEach(i=>{const x=new Date(i.end)>=new Date,L=i.validated?x?"Activo":"Vencido":"Pendiente",Z=new Date(i.created_at).toLocaleDateString("es-ES");l.push([i.customer||"N/A",i.phone||"N/A",i.service||"N/A",i.start||"N/A",i.end||"N/A",L,Z])}),p.length===0&&l.push(["No hay compras registradas","","","","","",""]),c(o,{head:[l[0]],body:l.slice(1),startY:80,styles:{fontSize:10,cellPadding:3},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{top:80,left:20,right:20}});const v=o.lastAutoTable.finalY+20;o.setFontSize(14),o.setFont("helvetica","bold"),o.text("📈 ESTADÍSTICAS",20,v);const R=p.length,F=p.filter(i=>i.validated&&new Date(i.end)>=new Date).length,G=p.filter(i=>!i.validated).length,j=p.filter(i=>i.validated&&new Date(i.end)<new Date).length,q=p.reduce((i,x)=>{const L=x.service||"Desconocido";return i[L]=(i[L]||0)+1,i},{});o.setFontSize(10),o.setFont("helvetica","normal"),o.text(`• Total de compras: ${R}`,20,v+15),o.text(`• Compras activas: ${F}`,20,v+25),o.text(`• Compras pendientes: ${G}`,20,v+35),o.text(`• Compras vencidas: ${j}`,20,v+45),o.text("• Servicios más populares:",20,v+60),Object.entries(q).sort(([,i],[,x])=>x-i).slice(0,3).forEach(([i,x],L)=>{o.text(`  ${L+1}. ${i}: ${x} compras`,25,v+70+L*10)});const k=o.getNumberOfPages();for(let i=1;i<=k;i++)o.setPage(i),o.setFontSize(8),o.text(`Página ${i} de ${k}`,20,o.internal.pageSize.height-10),o.text("Generado por StreamZone",o.internal.pageSize.width-60,o.internal.pageSize.height-10);const H=`reporte-compras-${new Date().toISOString().split("T")[0]}.pdf`;o.save(H),n("📄 Reporte PDF generado exitosamente"),setTimeout(()=>n(""),3e3)}catch(a){console.error("Error generando PDF:",a),n("❌ Error al generar el reporte PDF"),setTimeout(()=>n(""),3e3)}}}};export{Ee as a,Se as b,he as c,ve as u};
