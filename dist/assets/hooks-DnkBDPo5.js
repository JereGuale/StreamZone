const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ui-components-CeKtGgHu.js","assets/react-vendor-Y7T1HomI.js","assets/supabase-L-NHoLOp.js","assets/jspdf.es.min-Cj24ZQjq.js"])))=>i.map(i=>d[i]);
import{_ as Q}from"./supabase-L-NHoLOp.js";import{r as s,i as ue,k as ge,m as me,n as pe,S as oe,o as J,p as he,q as fe,v as Ee,w as Se,x as Ae,y as Pe,z as U,A as ve,s as G}from"./ui-components-CeKtGgHu.js";const ye="+593984280334",we="+593998799579",B={PICHINCHA:"0122407273 (Jeremias Joel Guale)",GUAYAQUIL:"0122407273 (Jeremias Joel Guale)",PACIFICO:"1061220256 (Byron Guale)",PAYPAL:"guale2023@outlook.com"};function Ie(v){const[b,p]=s.useState(!1),[x,T]=s.useState({isOpen:!1,message:""}),R=r=>{T({isOpen:!0,message:r})},A=()=>{T({isOpen:!1,message:""})},D=r=>{const{service:P,price:y,duration:u,devices:m,customer:h,phone:g,email:w,paymentMethod:f,notes:I}=r;return`ğŸ¬âœ¨ *Nueva Compra - StreamZone* âœ¨ğŸ¬

ğŸ‘‹ Â¡Hola! Tenemos una nueva compra registrada ğŸ‘‹

ğŸ‘¤ *Cliente:* ${h}
ğŸ“± *WhatsApp:* ${g}
ğŸ“§ *Email:* ${w||"No proporcionado"}

ğŸ¯ *Detalles del Servicio:*
ğŸ¬ *Servicio:* ${P}
ğŸ’° *Precio:* $${y}
â±ï¸ *DuraciÃ³n:* ${u} ${u===1?"mes":"meses"}
ğŸ“± *Dispositivos:* ${m}
ğŸ’³ *MÃ©todo de pago:* ${f}
ğŸ“ *Notas:* ${I||"Ninguna"}

ğŸ’³ *Datos para transferencia:*
ğŸ¦ *Pichincha:* ${B.PICHINCHA}
ğŸ›ï¸ *Guayaquil:* ${B.GUAYAQUIL}
ğŸŒŠ *PacÃ­fico:* ${B.PACIFICO}
ğŸ’³ *PayPal:* ${B.PAYPAL}

ğŸ‰âœ¨ Â¡Gracias por tu compra! âœ¨ğŸ‰
ğŸ’ Â¡Esperamos que disfrutes tu servicio! ğŸ’`},n=r=>{const P=D(r),y=`https://wa.me/${ye.replace("+","")}?text=${encodeURIComponent(P)}`,u=`https://wa.me/${we.replace("+","")}?text=${encodeURIComponent(P)}`,m=document.createElement("div");m.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",m.innerHTML=`
      <div class="bg-white rounded-xl p-6 max-w-md mx-4 shadow-2xl">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-gray-800">Â¡Compra Registrada! ğŸ‰</h3>
          <button id="closeModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        <div class="bg-orange-50 border border-orange-200 rounded-lg p-3 mb-4">
          <p class="text-orange-800 text-sm font-medium">âš ï¸ PASO OBLIGATORIO</p>
          <p class="text-orange-700 text-xs mt-1">Debes contactar por WhatsApp para confirmar tu compra y recibir las credenciales</p>
        </div>
        <p class="text-gray-600 mb-6">Selecciona un agente para continuar con tu compra:</p>
        <div class="space-y-3">
          <button id="agent1" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-semibold transition-colors">
            ğŸ‘¨â€ğŸ’¼ Agente 1 (+593 98 428 0334)
          </button>
          <button id="agent2" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold transition-colors">
            ğŸ‘¨â€ğŸ’¼ Agente 2 (+593 99 879 9579)
          </button>
        </div>
      </div>
    `,document.body.appendChild(m);const h=()=>{try{m&&m.parentNode&&document.body.removeChild(m)}catch{console.log("Modal ya cerrado")}};document.getElementById("agent1")?.addEventListener("click",()=>{h(),setTimeout(()=>{try{window.open(y,"_blank")}catch{alert("No se pudo abrir WhatsApp automÃ¡ticamente. Por favor, contacta al Agente 1: +593 98 428 0334")}},100)}),document.getElementById("agent2")?.addEventListener("click",()=>{h(),setTimeout(()=>{try{window.open(u,"_blank")}catch{alert("No se pudo abrir WhatsApp automÃ¡ticamente. Por favor, contacta al Agente 2: +593 99 879 9579")}},100)}),document.getElementById("closeModal")?.addEventListener("click",h)};return{processPurchase:async r=>{p(!0);try{console.log("ğŸ›’ Procesando compra para usuario registrado:",r);const P={customer:r.customer||"Cliente StreamZone",phone:r.phone||"+593000000000",service:r.service||"Servicio Premium",price:r.price||10,duration:r.duration||1,devices:r.devices||1,total:r.total||10,paymentMethod:r.paymentMethod||"pichincha",notes:r.notes||"",email:r.email||"cliente@streamzone.com",start:r.start||new Date().toISOString().slice(0,10),end:r.end||new Date(Date.now()+720*60*60*1e3).toISOString().slice(0,10)};console.log("âœ… Datos garantizados para usuario registrado:",P),console.log("ğŸ¯ Mostrando panel de agentes..."),n(P);try{console.log("ğŸ’¾ Intentando guardar en BD en segundo plano..."),console.log("ğŸ” Buscando usuario existente por email:",r.email);const{data:y}=await ue(r.email);let u=y?.id,m=y?.phone;if(u)console.log("âœ… Usuario encontrado por email:",u),console.log("ğŸ“± TelÃ©fono del usuario en BD:",m);else{console.log("ğŸ” Usuario no encontrado por email, buscando por telÃ©fono:",r.phone);const{data:h,error:g}=await ge(r.phone);if(h?.id)u=h.id,m=h.phone,console.log("âœ… Usuario encontrado por telÃ©fono:",u);else{console.log("ğŸ‘¤ Usuario no encontrado, creando nuevo usuario...");const w={name:r.customer,phone:r.phone,email:r.email||"sin-email@temp.com"},{data:f,error:I}=await me(w);if(I){console.warn("âš ï¸ Error creando usuario:",I),console.error("âŒ NO SE PUEDE CONTINUAR SIN USUARIO VÃLIDO");return}else u=f?.id,m=f?.phone,console.log("âœ… Usuario creado exitosamente:",u)}}if(u){console.log("ğŸ¯ TENEMOS userId:",u);const h={customer:r.customer,phone:m||r.phone,service:r.service,start:r.start,end:r.end,months:r.duration,price:r.price||0,validated:!1};console.log("ğŸ“± TelÃ©fono del formulario:",r.phone),console.log("ğŸ“± TelÃ©fono de la BD (usado):",m||r.phone),console.log("ğŸ’¾ Guardando compra pendiente en BD (campos correctos):",h),console.log("ğŸ” Llamando a createPurchase con:",JSON.stringify(h,null,2));const{data:g,error:w}=await pe(h);w?(console.error("âŒ Error guardando compra:",w),console.error("âŒ Detalles del error:",JSON.stringify(w,null,2)),console.error("âŒ Tipo de error:",typeof w),console.error("âŒ Mensaje del error:",w.message)):(console.log("âœ… Compra guardada como pendiente:",g),console.log("âœ… ID de la compra guardada:",g?.id),console.log("âœ… Validated status:",g?.validated),console.log("ğŸ¯ Â¡COMPRA GUARDADA EXITOSAMENTE! DeberÃ­a aparecer en admin."),console.log("ğŸ”„ Forzando recarga inmediata de compras pendientes..."),setTimeout(async()=>{try{const{getPendingPurchases:f}=await Q(async()=>{const{getPendingPurchases:M}=await import("./ui-components-CeKtGgHu.js").then(N=>N.O);return{getPendingPurchases:M}},__vite__mapDeps([0,1,2])),I=await f();console.log("ğŸ”„ RESULTADO INMEDIATO de getPendingPurchases:",I),console.log("ğŸ”„ Compras pendientes encontradas:",I.data?.length||0)}catch(f){console.error("âŒ Error en recarga inmediata:",f)}},1e3))}else console.error("âŒ NO HAY userId - NO SE PUEDE GUARDAR LA COMPRA"),console.error("âŒ purchaseData:",r)}catch(y){console.warn("âš ï¸ Error en BD (no crÃ­tico):",y)}}catch(P){console.error("âŒ Error crÃ­tico:",P),R("Error al procesar la compra. Por favor, intÃ©ntalo de nuevo.")}finally{p(!1)}},isProcessing:b,generateWhatsAppMessage:D,errorModal:x,closeErrorModal:A}}function xe(v){const[b,p]=s.useState([]),[x,T]=s.useState([]),[R,A]=s.useState([]),[D,n]=s.useState([]),[O,r]=s.useState(null),[P,y]=s.useState(oe),[u,m]=s.useState(J),[h,g]=s.useState(!1),[w,f]=s.useState(null),I=async()=>{try{const t=await Pe();if(t.data&&t.data.length>0){const i=new Set(J.map(o=>o.id)),k=oe.map(o=>o.id),H=J.map(o=>o.id),W=t.data.filter(o=>!o.is_combo&&!i.has(o.id)&&!o.id.startsWith("combo_")&&!o.name.toLowerCase().includes("combo")&&!o.name.includes(" + ")),q=t.data.filter(o=>o.is_combo||i.has(o.id)||o.id.startsWith("combo_")||o.name.toLowerCase().includes("combo")||o.name.includes(" + "));W.sort((o,c)=>{const e=k.indexOf(o.id),l=k.indexOf(c.id);return e===-1&&l===-1?o.name.localeCompare(c.name):e===-1?1:l===-1?-1:e-l}),q.sort((o,c)=>{const e=H.indexOf(o.id),l=H.indexOf(c.id);return e===-1&&l===-1?o.name.localeCompare(c.name):e===-1?1:l===-1?-1:e-l}),y(W),m(q)}}catch(t){console.error("Error loading products from DB:",t)}},M=async()=>{g(!0),f(null);try{console.log("ğŸ”„ loadAllPurchasesFromSupabase: Iniciando carga...");const t=await Ae();return console.log("ğŸ”„ loadAllPurchasesFromSupabase: Resultado recibido:",t),t.data&&Array.isArray(t.data)?(p(t.data),console.log("âœ… loadAllPurchasesFromSupabase: Todas las compras cargadas desde Supabase:",t.data.length),t.data.length>0&&console.log("ğŸ“‹ Primeras 3 compras:",t.data.slice(0,3).map(i=>({id:i.id,customer:i.customer,validated:i.validated,created_at:i.created_at}))),t.data):(console.warn("âš ï¸ loadAllPurchasesFromSupabase: No se pudieron cargar las compras desde Supabase"),p([]),[])}catch(t){return console.error("âŒ loadAllPurchasesFromSupabase: Error cargando compras desde Supabase:",t),f("Error cargando compras desde la base de datos"),p([]),[]}finally{g(!1)}},N=async()=>{try{console.log("ğŸ”„ loadPendingPurchases: Iniciando carga...");const t=await he();return console.log("ğŸ”„ loadPendingPurchases: Resultado recibido:",t),t.data&&Array.isArray(t.data)?(T(t.data),console.log("âœ… loadPendingPurchases: Compras pendientes cargadas:",t.data.length),t.data):(console.log("âš ï¸ loadPendingPurchases: No hay datos o no es array, estableciendo array vacÃ­o"),T([]),[])}catch(t){return console.error("âŒ loadPendingPurchases: Error cargando compras pendientes:",t),T([]),[]}},_=async t=>{try{const i=await Se(t);return i.data?(A(i.data),console.log("âœ… Compras activas del usuario cargadas:",i.data.length),i.data):(A([]),[])}catch(i){return console.error("âŒ Error cargando compras del usuario:",i),A([]),[]}},C=async()=>{try{const t=await Ee(7);return t.data?(n(t.data),console.log("âœ… Servicios prÃ³ximos a vencer cargados:",t.data.length),t.data):(n([]),[])}catch(t){return console.error("âŒ Error cargando servicios prÃ³ximos a vencer:",t),n([]),[]}},$=async()=>{try{const t=await fe();return t.data?(r(t.data),console.log("âœ… EstadÃ­sticas de renovaciones cargadas"),t.data):(r(null),null)}catch(t){return console.error("âŒ Error cargando estadÃ­sticas de renovaciones:",t),r(null),null}},z=async()=>{console.log("ğŸ”„ refreshAllStats: Iniciando recarga completa..."),g(!0),f(null);try{console.log("ğŸ”„ refreshAllStats: Cargando todas las compras..."),await M(),console.log("ğŸ”„ refreshAllStats: Cargando compras pendientes..."),await N(),console.log("ğŸ”„ refreshAllStats: Cargando servicios prÃ³ximos a vencer..."),await C(),console.log("ğŸ”„ refreshAllStats: Cargando estadÃ­sticas de renovaciones..."),await $(),await I(),console.log("âœ… refreshAllStats: Todas las estadÃ­sticas actualizadas desde Supabase")}catch(t){console.error("âŒ refreshAllStats: Error actualizando estadÃ­sticas:",t),f("Error actualizando estadÃ­sticas")}finally{g(!1)}};return s.useEffect(()=>{console.log("ğŸ”„ useSupabaseData: Iniciando carga de datos de admin..."),z()},[v]),s.useEffect(()=>{console.log("ğŸ”„ useSupabaseData: Cargando compras pendientes al inicio..."),(async()=>{const i=await N();console.log("ğŸ¯ RESULTADO INICIAL loadPendingPurchases:",i)})()},[]),s.useEffect(()=>{{console.log("ğŸ”„ useSupabaseData: Iniciando actualizaciÃ³n automÃ¡tica cada 5 segundos...");const t=setInterval(async()=>{console.log("ğŸ”„ ACTUALIZACIÃ“N AUTOMÃTICA: Recargando compras pendientes...");try{const i=await N();console.log("ğŸ”„ ACTUALIZACIÃ“N AUTOMÃTICA: Compras pendientes:",i?.length||0)}catch(i){console.error("âŒ Error en actualizaciÃ³n automÃ¡tica:",i)}},5e3);return()=>{console.log("ğŸ›‘ useSupabaseData: Deteniendo actualizaciÃ³n automÃ¡tica..."),clearInterval(t)}}},[v]),s.useEffect(()=>{A([])},[v]),s.useEffect(()=>{const t=i=>{i.key==="userPhone"&&i.newValue&&(console.log("ğŸ”„ TelÃ©fono de usuario cambiado, recargando compras..."),g(!0),_(i.newValue).finally(()=>g(!1)))};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[]),{allPurchases:b,pendingPurchases:x,userActivePurchases:R,expiringServices:D,renewalStats:O,services:P,combos:u,loading:h,error:w,loadAllPurchasesFromSupabase:M,loadPendingPurchases:N,loadUserActivePurchases:_,loadExpiringServices:C,loadRenewalStats:$,refreshAllStats:z,refreshUserPurchases:async t=>{console.log("ğŸ”„ Forzando recarga de compras del usuario:",t),g(!0);try{const i=await _(t);return console.log("âœ… Compras del usuario recargadas:",i?.length||0),i}catch(i){return console.error("âŒ Error recargando compras del usuario:",i),[]}finally{g(!1)}}}}const Oe=()=>{const[v,b]=s.useState(()=>U.load("userProfile",null)),[p,x]=s.useState(()=>!!U.load("adminLogged",!1)),[T,R]=s.useState(()=>U.load("userProfileData",null)),[A,D]=s.useState(()=>U.load("allPurchases",[])),[n,O]=s.useState("login"),[r,P]=s.useState(""),[y,u]=s.useState(""),[m,h]=s.useState("");return s.useEffect(()=>{U.save("userProfile",v)},[v]),s.useEffect(()=>{U.save("userProfileData",T)},[T]),s.useEffect(()=>{U.save("allPurchases",A)},[A]),s.useEffect(()=>{U.save("adminLogged",p)},[p]),{user:v,setUser:b,adminLogged:p,setAdminLogged:x,userProfile:T,setUserProfile:R,allPurchases:A,setAllPurchases:D,authStep:n,setAuthStep:O,resetEmail:r,setResetEmail:P,resetToken:y,setResetToken:u,resetCode:m,setResetCode:h,handleLogin:C=>{b(C)},handleLogout:()=>{b(null),R(null)},handleAdminLogin:C=>{C&&x(!0)},handleAdminLogout:()=>{x(!1)},handleForgotPassword:(C,$)=>{P(C),u($),O("code")},handleCodeVerified:C=>{u(C),O("newpassword")},handlePasswordReset:()=>{O("login")}}},Ce=[{email:"gualejeremi@gmail.com",role:"principal",canGenerateKeys:!1,canDeleteOthers:!0,isProtected:!0}],Ne=(v=[],b,p)=>{const[x,T]=s.useState(Ce),[R,A]=s.useState(!1),[D,n]=s.useState(""),[O,r]=s.useState("dashboard"),[P,y]=s.useState(!1),[u,m]=s.useState(!1),[h,g]=s.useState(!1),[w,f]=s.useState(!1),[I,M]=s.useState(null),[N,_]=s.useState(!1),[C,$]=s.useState(null),z=x.map(o=>o.email);return{adminUsers:x,setAdminUsers:T,loading:R,setLoading:A,msg:D,setMsg:n,adminView:O,setAdminView:r,adminDrawerOpen:P,setAdminDrawerOpen:y,adminMenuOpen:u,setAdminMenuOpen:m,adminRegisterPurchaseOpen:h,setAdminRegisterPurchaseOpen:g,editPurchaseOpen:w,setEditPurchaseOpen:f,editingPurchase:I,setEditingPurchase:M,approvePurchaseOpen:N,setApprovePurchaseOpen:_,selectedPurchase:C,setSelectedPurchase:$,adminEmails:z,handleToggleValidate:async o=>{const c=v.find(l=>l.id===o);if(!c)return;if(!c.validated){$(c),_(!0);return}const e="invalidar";if(!G){n("âŒ Error: Base de datos no disponible"),setTimeout(()=>n(""),3e3);return}if(confirm(`Â¿EstÃ¡s seguro de que quieres ${e} la compra de ${c.customer} - ${c.service}?`)){A(!0);try{const{error:l}=await G.from("purchases").update({validated:!1}).eq("id",o);if(l)throw l;b(E=>E.map(S=>S.id===o?{...S,validated:!1}:S)),n("âœ…âœ¨ Compra invalidada exitosamente âœ¨âœ…"),setTimeout(()=>n(""),3e3),p&&await p()}catch(l){console.error("Error al actualizar compra:",l),n("âŒ Error al actualizar la compra"),setTimeout(()=>n(""),3e3)}finally{A(!1)}}},handleDeletePurchase:async o=>{const c=v.find(l=>l.id===o);if(!c)return;const e=c.validated?`âš ï¸ ADVERTENCIA: Â¿EstÃ¡s seguro de que quieres ELIMINAR PERMANENTEMENTE a ${c.customer}?

Escribe "ELIMINAR" para confirmar:`:`Â¿EstÃ¡s seguro de que quieres rechazar la compra de ${c.customer}?`;if(confirm(e)){if(!G){n("âŒ Error: Base de datos no disponible"),setTimeout(()=>n(""),3e3);return}if(!(c.validated&&prompt("Escribe exactamente: ELIMINAR")!=="ELIMINAR")){A(!0);try{const{error:l}=await G.from("purchases").delete().eq("id",o);if(l)throw l;b(E=>E.filter(S=>S.id!==o)),n("âœ…âœ¨ Compra eliminada exitosamente âœ¨âœ…"),setTimeout(()=>n(""),3e3),p&&await p()}catch(l){console.error("Error al eliminar compra:",l),n("âŒ Error al eliminar la compra"),setTimeout(()=>n(""),3e3)}finally{A(!1)}}}},handleEditPurchase:o=>{M(o),f(!0)},handleReminderPurchase:o=>{const c=new Date,e=new Date(o.end),l=Math.ceil((e.getTime()-c.getTime())/(1e3*60*60*24));let E=`â˜… StreamZone â˜…
Â¡Hola ${o.customer}! ğŸ¬

`;l<=0?E+=`Tu servicio ${o.service} vencio el ${o.end}. âš ï¸

Responde para reactivarlo. Â¡Gracias! âœ¨`:E+=`Tu servicio ${o.service} vence el ${o.end} (${l} dias). â°

Responde para renovar. Â¡Gracias! âœ¨`;const V=`https://api.whatsapp.com/send?phone=${o.phone.replace(/\D/g,"")}&text=${encodeURIComponent(E)}`;try{window.open(V,"_blank"),n(`ğŸ“±âœ¨ Recordatorio enviado a ${o.customer}`),setTimeout(()=>n(""),5e3)}catch{n("âŒ Error al abrir WhatsApp"),setTimeout(()=>n(""),3e3)}},handleApproveSuccess:async()=>{if(b(o=>o.map(c=>c.id===C?.id?{...c,validated:!0}:c)),p)try{await p()}catch(o){console.error("âŒ Error recargando datos:",o)}},handleUpdatePurchase:async(o,c)=>{try{const{error:e}=await ve(o,c);if(e)throw e;b(l=>l.map(E=>E.id===o?{...E,...c}:E)),n("âœ… Compra actualizada correctamente"),setTimeout(()=>n(""),5e3),p&&await p()}catch(e){console.error("âŒ Error actualizando compra:",e),n(`âŒ Error: ${e.message}`),setTimeout(()=>n(""),5e3)}},handleExportCSV:async()=>{try{const o=(await Q(async()=>{const{default:a}=await import("./jspdf.es.min-Cj24ZQjq.js").then(d=>d.j);return{default:a}},__vite__mapDeps([3,2,1]))).default,c=(await Q(async()=>{const{default:a}=await import("./jspdf.plugin.autotable-DZlIrCiz.js");return{default:a}},[])).default,e=new o,l=e.internal.pageSize.width,E=new Date,S=[31,41,55],V=[37,99,235],X=[5,150,105];e.setFillColor(S[0],S[1],S[2]),e.rect(0,0,l,45,"F");try{e.addImage("/logo_app.png","PNG",15,7,30,30)}catch{e.setTextColor(255,255,255),e.setFontSize(24),e.setFont("helvetica","bold"),e.text("SZ",20,25)}e.setTextColor(255,255,255),e.setFontSize(22),e.setFont("helvetica","bold"),e.text("STREAMZONE",50,20),e.setFontSize(10),e.setFont("helvetica","normal"),e.text("SISTEMA INTEGRAL DE GESTIÃ“N OPERATIVA",50,28),e.setFontSize(9),e.text(`Generado: ${E.toLocaleDateString("es-ES")} ${E.toLocaleTimeString("es-ES")}`,l-20,20,{align:"right"}),e.text("Documento Administrativo Original",l-20,26,{align:"right"});const Y=v.filter(a=>a.validated),ae=Y.filter(a=>new Date(a.end)>=E).length,re=Y.reduce((a,d)=>a+(Number(d.price)||0),0),se=v.filter(a=>!a.validated).length,Z=(a,d,L,ce,de,j)=>{e.setFillColor(243,244,246),e.rect(a,d,L,24,"F"),e.setDrawColor(209,213,219),e.rect(a,d,L,24,"D"),e.setFontSize(8),e.setTextColor(75,85,99),e.setFont("helvetica","bold"),e.text(ce.toUpperCase(),a+5,d+8),e.setFontSize(14),e.setTextColor(j[0],j[1],j[2]),e.text(de,a+5,d+18)},F=(l-50)/3;Z(20,55,F,"Capital en Caja",`$${re.toLocaleString()}`,X),Z(25+F,55,F,"Suscripciones Activas",ae.toString(),V),Z(30+F*2,55,F,"Ventas por Validar",se.toString(),[220,38,38]),e.setTextColor(S[0],S[1],S[2]),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("RENDIMIENTO POR PLATAFORMA",20,95);const ne=Y.reduce((a,d)=>{const L=d.service||"Otros";return a[L]||(a[L]={count:0,revenue:0}),a[L].count+=1,a[L].revenue+=Number(d.price)||0,a},{}),le=Object.entries(ne).filter(([,a])=>a.count>0).sort((a,d)=>d[1].revenue-a[1].revenue).map(([a,d])=>[a.toUpperCase(),d.count.toString(),`$${d.revenue.toLocaleString()}`]);c(e,{head:[["PLATAFORMA","VENTAS EXITOSAS","TOTAL GENERADO"]],body:le,startY:102,margin:{left:20,right:20},styles:{fontSize:8,cellPadding:4},headStyles:{fillColor:V,textColor:[255,255,255],fontStyle:"bold"},columnStyles:{1:{halign:"center"},2:{halign:"right",fontStyle:"bold"}}});const K=e.lastAutoTable.finalY+15;e.setTextColor(S[0],S[1],S[2]),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("HISTORIAL DETALLADO DE TRANSACCIONES",20,K);const ie=v.map(a=>{const d=new Date(a.end)>=E,L=a.validated?d?"VIGENTE":"VENCIDO":"PENDIENTE";return[(a.customer||"N/A").toUpperCase(),a.service||"N/A",a.start||"-",a.end||"-",`$${(Number(a.price)||0).toLocaleString()}`,L]});c(e,{head:[["CLIENTE","SERVICIO","FECHA INICIO","VENCIMIENTO","PRECIO","ESTADO"]],body:ie,startY:K+7,margin:{left:20,right:20},styles:{fontSize:7,cellPadding:3,textColor:[31,41,55],lineColor:[229,231,235],lineWidth:.1},headStyles:{fillColor:S,textColor:[255,255,255],fontStyle:"bold",halign:"center"},columnStyles:{2:{halign:"center"},3:{halign:"center"},4:{halign:"right",fontStyle:"bold"},5:{halign:"center",fontStyle:"bold"}},alternateRowStyles:{fillColor:[252,253,255]},didParseCell:a=>{if(a.section==="body"&&a.column.index===5){const d=a.cell.raw;d==="VIGENTE"&&(a.cell.styles.textColor=[5,150,105]),d==="PENDIENTE"&&(a.cell.styles.textColor=[217,119,6]),d==="VENCIDO"&&(a.cell.styles.textColor=[220,38,38])}}});const ee=e.getNumberOfPages();for(let a=1;a<=ee;a++)e.setPage(a),e.setFontSize(8),e.setTextColor(156,163,175),e.text(`Generado para StreamZone Admin â€¢ PÃ¡gina ${a} de ${ee}`,20,e.internal.pageSize.height-10),e.text("StreamZone CRM - Control y Auditoria Financiera",l-20,e.internal.pageSize.height-10,{align:"right"});e.save(`StreamZone_Report_${E.toISOString().split("T")[0]}.pdf`),n("âœ… Reporte Ejecutivo con Logo y Categorias generado"),setTimeout(()=>n(""),4e3)}catch(o){console.error("Error generando PDF:",o),n("âŒ Error al generar el reporte corporativo"),setTimeout(()=>n(""),3e3)}}}};export{xe as a,Ne as b,Ie as c,Oe as u};
